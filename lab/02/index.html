<!DOCTYPE HTML>
<html lang="zh-Hans" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>实验 2：使用 FMM、BMM 算法分词 - Learn NLP</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/custom-style.css">
        <link rel="stylesheet" href="../../theme/css/custom-font.css">
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">首页</a></li><li class="chapter-item expanded "><a href="../../lab/index.html"><strong aria-hidden="true">1.</strong> 实验</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../lab/01/index.html"><strong aria-hidden="true">1.1.</strong> 实验 1：互联网语料获取</a></li><li class="chapter-item expanded "><a href="../../lab/02/index.html" class="active"><strong aria-hidden="true">1.2.</strong> 实验 2：使用 FMM、BMM 算法分词</a></li><li class="chapter-item expanded "><a href="../../lab/misc/report-template.html"><strong aria-hidden="true">1.3.</strong> 实验报告模板</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Learn NLP</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/tsagaanbar/learn-NLP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/tsagaanbar/learn-NLP/edit/main/src/lab/02/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="自然语言处理实验二"><a class="header" href="#自然语言处理实验二">自然语言处理：实验二</a></h1>
<table>
    <style>
        th { text-justify: distribute; text-align-last: justify; text-align: justify; text-align: center; }
        td { text-align: center; }
    </style>
    <tbody>
        <tr><th>学院</th><td>信息工程学院</td></tr>
        <tr><th>指导教师</th><td>孙媛</td></tr>
        <tr><th>班级</th><td>19 级计算机科学与技术 1 班</td></tr>
        <tr><th>学生姓名</th><td>John Doe</td></tr>
        <tr><th>学号</th><td>19000000</td></tr>
    </tbody>
</table>
<p>日期： 2021 年 9 月 29 日</p>
<h2 id="摘要"><a class="header" href="#摘要">摘要</a></h2>
<h2 id="目录"><a class="header" href="#目录">目录</a></h2>
<h2 id="一实验内容"><a class="header" href="#一实验内容">一、实验内容</a></h2>
<p>实验内容：对语料库的文本进行分词并存储。</p>
<p>分别采用正向最大匹配算法、逆向最大匹配算法进行分词。</p>
<p>以 <a href="https://github.com/fxsjy/jieba">jieba</a> 分词的分词结果作为标准语料，计算P、R、F值。</p>
<h2 id="二实验原理"><a class="header" href="#二实验原理">二、实验原理</a></h2>
<p>包含：存在的主要问题，用什么方法解决，原理是什么？</p>
<p>基于词典的切分方法</p>
<p>最大匹配法（Maximum Matching, MM）</p>
<p>有词典切分，机械切分</p>
<ul>
<li>正向最大匹配算法（Forward MM, FMM）</li>
<li>逆向最大匹配算法（Backward MM, BMM）</li>
<li>双向最大匹配算法（Bi-directional MM）</li>
</ul>
<p>句子 \(S = c_1 c_2 \cdots c_n\)：句子由若干字符 \(c\) 组成。</p>
<p>假设词 \(w_i = c_1c_2 \cdots c_m\)，其中 \(m\) 为词典中最长词的字数。</p>
<h2 id="三整体框架"><a class="header" href="#三整体框架">三、整体框架</a></h2>
<p>包含整体框图，各主要模块的功能。</p>
<p>图表都需要 <strong>带编号</strong></p>
<h2 id="四主要程序模块"><a class="header" href="#四主要程序模块">四、主要程序模块</a></h2>
<p>考虑到可能会涉及大量词语的存储与检索，尝试使用将词库载入并存储于自己实现的 Trie 字典树结构中。</p>
<p>为了简便起见，使用 Python 中的字典结构模拟节点对象。</p>
<p><a href="./my_trie.py">my_trie.py</a></p>
<pre><code class="language-python">def insert(node, s):
    current = node
    for c in s:
        if c not in current['children'].keys():
            current['children'][c] = { 'c': c, 'children':dict(), 'cnt': 0 }
        current = current['children'][c]
    current['cnt'] += 1


def find(node, s):
    for c in s:
        if c in node['children'].keys():
            node = node['children'][c]
        else:
            return False
    return node['cnt'] &gt; 0


def traverse(node, s=''):
    for key in node['children'].keys():
        s += node['children'][key]['c']
        traverse(node['children'][key], s)
        s = s[:-1]
    if node['cnt'] &gt; 0:
        print(s)

</code></pre>
<p>使用示例：</p>
<p><a href="./trie_test.py">trie_test.py</a></p>
<pre><code class="language-python">import my_trie as trie

root = { 'c': '', 'children':dict(), 'cnt': 0 }

trie.insert(root, 'apple')
trie.insert(root, 'loop')
trie.insert(root, 'app')

test_cases = [
    ('a', False),
    ('ap', False),
    ('app', True),
    ('appl', False),
    ('apple', True),
    ('l', False),
    ('lo', False),
    ('loo', False),
    ('loop', True),
    ('loopa', False),
    ('loopan', False)
]

for t in test_cases:
    print(t[0], '\tExpected: ', t[1], '\tGot: ', trie.find(root, t[0]))

print('All words:')

trie.traverse(root)
</code></pre>
<p>从文件中加载字典到 Trie 树，并进行最大正向匹配、最大逆向匹配：</p>
<p><a href="./FMM_BMM_trie.py">FMM_BMM_trie.py</a> （使用 Python 内建的 set 类型：<a href="./FMM_BMM.py">FMM_BMM.py</a>）</p>
<pre><code class="language-python">from my_trie import *

def load_wordlist(filename):
    wordlist = { 'c': '', 'children':dict(), 'cnt': 0 }
    maxlen = 0
    cnt = 0
    with open(filename) as f:
        if f.readline().strip() == '@Lexicon':
            for line in f:
                word = line.split()[1]
                maxlen = max(maxlen, len(word))
                insert(wordlist, word)
                cnt += 1
    return wordlist, cnt, maxlen


def FMM(sentence, wordlist, maxlen):
    maxlen = max(1, maxlen)
    tokens = []
    i = 0
    while i &lt; len(sentence):
        n = len(sentence) - i # 未被切分的字串长度
        m = min(maxlen, n)
        w = sentence[i:i+m]
        while len(w) &gt; 1:
            if find(wordlist, w):
                break
            else:
                w = w[0:-1]
        tokens.append(w)
        i += len(w)
    return tokens


def BMM(sentence, wordlist, maxlen):
    maxlen = max(1, maxlen)
    tokens = []
    i = len(sentence)
    while i &gt;= 1:
        n = i # 未被切分的字串长度
        m = min(maxlen, n)
        w = sentence[i-m:i]
        while len(w) &gt; 1:
            if find(wordlist, w):
                break
            else:
                w = w[1:]
        tokens.append(w)
        i -= len(w)
    tokens.reverse()
    return tokens
</code></pre>
<p>计算 P、R、F 值：</p>
<p><a href="./calc.py">calc.py</a></p>
<pre><code class="language-python">special_characters = set(list(&quot;()[]+-*/&lt;&gt;|\\;:\&quot;\'\,.?!@#$%^&amp;~`\{\}（）【】《》，。？“”‘’；：——「」『』〔〕&quot;))

#包括部分特殊字符，在进行分词比对时将特殊字符排除，以免对结果产生一定的影响

def calc_hits(truth, result):
    # 传入分词得到的结果（列表），以及“正确分词”结果
    cut_truth = [item for item in truth if item not in special_characters]
    cut_result = [item for item in result if item not in special_characters]
    i = 0  # 指向 truth 中的 token
    j = 0  # 指向 result 中的 token
    l1 = 0 # i 所指向词串，对应在原句中的长度
    l2 = 0 # j 所指向词串，对应在原句中的长度
    hits = 0
    missmatches = []
    while i &lt; len(cut_truth) and j &lt; len(cut_truth):
        if l1 &lt; l2:
            l1 += len(cut_truth[i])
            i += 1
        elif l1 &gt; l2:
            l2 += len(cut_result[j])
            j += 1
        else: 
            if cut_truth[i] == cut_result[j]:
                hits += 1
            else:
                missmatches.append(cut_result[j])
            l1 += len(cut_truth[i])
            i += 1
            l2 += len(cut_result[j])
            j += 1
    return hits, missmatches


def calc_PRF(truth, result):
    hits = calc_hits(truth, result)
    P = hits / len(result)      # precision
    R = hits / len(truth)       # recall
    F = (2 * P * R) / (P + R)   # F1
    return P, R
</code></pre>
<p>交互式分词程序：</p>
<p><a href="./demo.py">demo.py</a></p>
<pre><code class="language-python">from FMM_BMM_trie import *
from calc import *

import jieba

wordlist, cnt, maxlen = load_wordlist('wordlist.dic')

while True:
    s = input().strip()
    if s == '#':
        break
    ground_truth = jieba.lcut(s)  # 'ground truth'
    fmm = FMM(s, wordlist, maxlen)
    bmm = BMM(s, wordlist, maxlen)

    print('jieba:     ', &quot;/&quot;.join(ground_truth))

    print('-' * 20)

    print('FMM:       ', &quot;/&quot;.join(fmm))
    hits, _ = calc_hits(ground_truth, fmm)
    print('Hits:      ', hits)
    print('Precision: ', hits / len(fmm))
    print('Recall:    ', hits / len(ground_truth))

    print('-' * 20)

    print('BMM:       ', &quot;/&quot;.join(bmm))
    hits, _ = calc_hits(ground_truth, bmm)
    print('Hits:      ', hits)
    print('Precision: ', hits / len(bmm))
    print('Recall:    ', hits / len(ground_truth))
</code></pre>
<p>详细介绍各个主要模块的功能及实现流程。</p>
<h2 id="五实验结果"><a class="header" href="#五实验结果">五、实验结果</a></h2>
<p>详细分析实验结果，除了包含定量评价，还要有定性评价。
对存在的问题，要着重剖析。</p>
<h2 id="六总结"><a class="header" href="#六总结">六、总结</a></h2>
<p>除了对整个实验进行概要总结，如果有程序亮点，可以在这阐述。</p>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<p>如有参考文献，请附上。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../lab/01/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../lab/misc/report-template.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../lab/01/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../lab/misc/report-template.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
