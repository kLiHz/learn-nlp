<!DOCTYPE HTML>
<html lang="zh-Hans" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>实验 3：使用 2 元文法消除歧义 - Learn NLP</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/custom-style.css">
        <link rel="stylesheet" href="../../theme/css/custom-font.css">
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">首页</a></li><li class="chapter-item expanded "><a href="../../lab/index.html"><strong aria-hidden="true">1.</strong> 实验</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../lab/01/index.html"><strong aria-hidden="true">1.1.</strong> 实验 1：互联网语料获取</a></li><li class="chapter-item expanded "><a href="../../lab/02/index.html"><strong aria-hidden="true">1.2.</strong> 实验 2：使用 FMM、BMM 算法分词</a></li><li class="chapter-item expanded "><a href="../../lab/03/index.html" class="active"><strong aria-hidden="true">1.3.</strong> 实验 3：使用 2 元文法消除歧义</a></li><li class="chapter-item expanded "><a href="../../lab/misc/report-template.html"><strong aria-hidden="true">1.4.</strong> 实验报告模板</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Learn NLP</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/tsagaanbar/learn-NLP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/tsagaanbar/learn-NLP/edit/main/src/lab/03/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="自然语言处理实验"><a class="header" href="#自然语言处理实验">自然语言处理实验</a></h1>
<p style="text-align: center;">实验三</p>
<p style="text-align: center;">采用 2 元文法进行文本分词消歧</p>
<img src="../misc/logo.svg" alt="School Logo" style="max-width: 30%;">
<table>
    <style>
        td.distrib { text-justify: distribute; text-align-last: justify; text-align: justify; text-align: center; }
        td.center { text-align: center; }
    </style>
    <tbody>
        <tr><td class="distrib">学院</td><td class="center">信息工程学院</td></tr>
        <tr><td class="distrib">指导教师</td><td class="center">孙媛</td></tr>
        <tr><td class="distrib">班级</td><td class="center">19 级计算机科学与技术 1 班</td></tr>
        <tr><td class="distrib">学生姓名</td><td class="center">John Doe</td></tr>
        <tr><td class="distrib">学号</td><td class="center">19000000</td></tr>
    </tbody>
</table>
<p style="text-align: center;">日期： 2021 年 11 月 7 日</p>
<div style="page-break-after: always;"></div>
<h2 id="摘要"><a class="header" href="#摘要">摘要</a></h2>
<h2 id="目录"><a class="header" href="#目录">目录</a></h2>
<h2 id="一实验内容"><a class="header" href="#一实验内容">一、实验内容</a></h2>
<p>在使用正向、逆向最大匹配等方式进行基于字典的分词时，总会遇到具有歧义的情况。</p>
<ul>
<li>对于正向、逆向最大匹配结果中的歧义问题，采用 2 元文法进行消歧，并对消歧后的文本，再次计算 P、R、F1 值；</li>
<li>利用 2 元文法计算测试语料中每段话的概率。</li>
</ul>
<p>参考训练语料为“1998 人民日报（已分词）”，可根据需要自行修改格式，也可以在训练语料中加入 jieba 分词的结果。</p>
<p>提交内容：</p>
<p>1、实验报告（包括实验原理，主要程序流程，实验结果及分析）</p>
<p>2、分词后的语料（部分），概率计算结果</p>
<p>3、实验源代码文件 </p>
<p>本次实验主要做什么？</p>
<h2 id="二实验原理"><a class="header" href="#二实验原理">二、实验原理</a></h2>
<p>在使用 FMM、BMM 等方式进行基于字典的分词时，总会遇到具有歧义的情况。</p>
<p>例如，“商品和服务”经过 FMM、BMM 分词，可以有以下的分词结果：</p>
<table><thead><tr><th align="center">分词方式</th><th align="center">分词结果</th></tr></thead><tbody>
<tr><td align="center">FMM</td><td align="center">['商品', '和服', '务']</td></tr>
<tr><td align="center">BMM</td><td align="center">['商品', '和', '服务']</td></tr>
</tbody></table>
<p>显然，第二种情况更为合理，因为第二种出现的概率较前一种更高。这便是统计自然语言处理。</p>
<p>于是，便可以通过对语言进行建模，以评估其出现的概率，进而达到消除歧义的目的。</p>
<h3 id="n-gram"><a class="header" href="#n-gram">N-Gram</a></h3>
<p>考虑到自然语言的复杂多变，语料库中不可能穷尽所有的句子，因此，直接对语句进行统计是不现实的，于是，将词视作单位便是一个自然的选择。</p>
<p>可以将句子表示为“单词”列表，这里的“单词”指的是统计基元。将第 \(i\) 个基元记作 \(w_i\)，则句子 \(s\) 可以表示为以下形式：</p>
<p>\[s = w_1 w_2 \cdots w_n\]</p>
<p>其中， \(w_i\) 的概率由他之前的基元 \(w_1, w_2, ..., w_{i-1}\) 决定，也称作 \(w_i\) 的历史串。</p>
<p>\[
\begin{align}
p(s) & = p(w_1 w_2 \cdots w_n) \\
     & = p(w_1 \vert w_0) \times p(w_2 \vert w_0 w_1) \times \cdots \times p(w_{n+1} \vert w_0 w_1 \cdots w_n) \\
     & = \prod_{i=1}^{n+1}p(w_i \vert w_0 w_1 \cdots w_{i-1}) \\
\end{align}
\]</p>
<p>上式中，\(w_0\) 为句子开始的标志（Begin Of Sentence），记作 \(\text{&lt;BOS&gt;}\)，\(w_n+1}\) 表示句子结束的标志（End Of Sentence），记作 \(\text{&lt;EOS&gt;}\)。</p>
<p>但是，上述方式下，随着历史串的长度的增加，语言模型中参数 <em>p</em> 的计算代价就会变得十分昂贵。于是，我们可以只考虑前 \(N-1\) 个基元，以得到一个近似的概率，这时得到的语言模型就称为 <em>N</em> 元文法（<em>N</em>-Gram）。</p>
<p>记 \(w_i^j\) 表示词 \(w_i\cdots w_j\)，则 <em>N</em> 元文法下句子的概率可以表示为：</p>
<p>\[p(s) \approx \prod_{i=1}^{n+1}{p(w_i| w_{i-N+1}^{i-1})p(w_i| w_{i-N+1}^{i-1})} \]</p>
<p>实际使用中，通常使用一元、二元、三元文法进行处理。</p>
<p>假设句子“John read a book”，当使用 2 元文法计算概率时，就是如下的结果：</p>
<p>\[
\begin{align}
P(\text{John read a book}) 
=&amp; P(\text{John    | &lt;BOS&gt;}) \times \\ &amp;
P(\text{read    | John   }) \times \\ &amp;
P(\text{a       | read   }) \times \\ &amp;
P(\text{book    | a      }) \times \\ &amp;
P(\text{&lt;EOS&gt; | book   })
\end{align}
\]</p>
<p><em>N</em>-Gram 中，\( p(w_i| w_{i-N+1}^{i-1}) \) 可由最大似然估计求得：</p>
<p>\[
p(w_i | w_{i-n+1}^{i-1})
= f(w_i | w_{i-n+1}^{i-1})
= \frac{c(w_{i-n+1}^{i})}{ \sum_{w}{c(w_{i-n+1}^{i-1} w)} }
\]</p>
<p>公式中的 \(w\) 表示任意词，因此 \(\sum_{w}{c(w_{i-n+1}^{i-1} w)}\) 实际上就是 \( w_{i-n+1}^{i-1} \) 在训练语料中的出现次数，即 \(c(w_{i-n+1}^{i-1})\)。\( f(w_i | w_{i-n+1}^{i-1}) \) 是在给定 \( w_{i-n+1}^{i-1} \) 的条件下，\(w_i\) 出现的相对频度。</p>
<p>假设给定训练语料：</p>
<pre><code>John read Moby Dick
Mary read a different book
She read a booky by Cher
</code></pre>
<p>\[
\begin{align}
&amp; P(\text{John}    | \text{&lt;BOS&gt;}) = \frac{ c( \text{&lt;BOS&gt; John} ) }{ c( \text{&lt;BOS&gt;} ) } = \frac 1 3 \\
&amp; P(\text{read}    | \text{John}   ) = \frac{ c( \text{John read}    ) }{ c( \text{John}    ) } = \frac 1 1 \\
&amp; P(\text{a}       | \text{read}   ) = \frac{ c( \text{read a}       ) }{ c( \text{read}    ) } = \frac 2 3 \\
&amp; P(\text{book}    | \text{a}      ) = \frac{ c( \text{a book}       ) }{ c( \text{a}       ) } = \frac 1 2 \\
&amp; P(\text{&lt;EOS&gt;} | \text{book}   ) = \frac{ c( \text{book &lt;EOS&gt;} ) }{ c( \text{book}    ) } = \frac 1 2
\end{align}
\]</p>
<p>则 \(P(\text{John read a book}) = \frac 1 3 \times 1 \times \frac 2 3 \times \frac 1 2 \times \frac 1 2 \approx 0.06 \)。</p>
<p>考虑句子“Cher read a book”，可得 \( P(\text{Cher read a book}) = 
P(\text{Cher}    | \text{&lt;BOS&gt;}) \times
P(\text{read}    | \text{Cher}   ) \times
P(\text{a}       | \text{read}   ) \times
P(\text{book}    | \text{a}      ) \times
P(\text{&lt;EOS&gt;} | \text{book}   ) \)。</p>
<p>又 
\[
\begin{align}
&amp; P(\text{Cher}    | \text{&lt;BOS&gt;}) = \frac{ c( \text{&lt;BOS&gt; Cher} ) }{ c( \text{&lt;BOS&gt;} ) } = \frac 0 3, \\
&amp; P(\text{read}    | \text{Cher}   ) = \frac{ c( \text{Cher read}    ) }{ c( \text{Cher}    ) } = \frac 0 1
\end{align}
\]</p>
<p>最终得 \(P(\text{Cher read a book}) = 0\)。</p>
<h3 id="数据平滑"><a class="header" href="#数据平滑">数据平滑</a></h3>
<p>在上面的例子中，由于数据匮乏，导致了零概率问题。对此，需要使用数据平滑来调整最大似然估计得概率值，使零概率增值，使非零概率下调，从而消除零概率，提高模型的整体正确率。</p>
<p>一种简单的方法即为加 1 法，即将每一种情况出现的次数加 1。在 1 元文法（uni-gram）下，设有 \(w_1, w_2, w_3\) 三个词，概率分别为：1/3, 0, 2/3，则“加 1”后，它们的概率变为 2/6, 1/6, 3/6（由于每个词的数量都增加了 1 个，词的总数变为了 6，因此分母为 6）。</p>
<p>对于 2 元文法，假定所有语料的词汇量（全部可能的基元数）为 <em>V</em>，则 \( P(w_i | w_{i-1}) = \frac{1+c(w_{i-1}w_i)}{|V| + c(w_{i-1})} \)。</p>
<h3 id="训练"><a class="header" href="#训练">训练</a></h3>
<p>训练过程即为统计二元语法频次以及一元语法频次，建立相应的统计语言模型。</p>
<p>训练文本通常由一个或多个句子组成。比如，训练样本有下面这样的语句：</p>
<pre><code class="language-text">一 只 黑叶猴 和 一 只 灰叶猴 因 吃 了 游客 投 喂 的 食物 ， 腹泻 、 腹胀 而 死 。
</code></pre>
<p>这样以间隔符间隔开的语句可以视作列表的形式：</p>
<pre><code>[ '一', '只', '黑叶猴', '和', '一', '只', 
  '灰叶猴', '因', '吃', '了', '游客', 
  '投', '喂', '的', '食物', '，', 
  '腹泻', '、', '腹胀', '而', '死', '。' ]
</code></pre>
<p>本实验计划以短句作为句子的单位，并规定了一组用于断句的标点符号。</p>
<pre><code class="language-python">punctuations = {',', '，', ';', '；', '。', '!', '！', '?', '？', '（', '）', '—'}
</code></pre>
<p>根据二元文法对列表中的词进行匹配，可以得到下边的结果：</p>
<pre><code>[ ('&lt;BOS&gt;', '一只'), ('一只', '黑叶猴'), ('黑叶猴', '和'), ('和', '一只'), 
  ('一只', '灰叶猴'), ('灰叶猴', '因'), ('因', '吃'), ('吃', '了'), 
  ('了', '游客'), ('游客', '投'), ('投', '喂'), ('喂', '的'), ('的', '食物'), 
  ('食物', '&lt;EOS&gt;'), ('&lt;BOS&gt;', '腹泻'), ('腹泻', '腹胀'), ('腹胀', '而'), 
  ('而', '死'), ('死', '&lt;EOS&gt;') ]
</code></pre>
<p>将这些元组交与用于训练二元文法模型的函数。</p>
<p>按照行来读取文本，并将列表形式的数据</p>
<h3 id="消除歧义"><a class="header" href="#消除歧义">消除歧义</a></h3>
<p>对于某一句话，不同的分词方法，可能会得到不同的结果。结果中的不同之处被视作“歧义”。为了得到相对情况下最为准确的分词结果，需要在每处歧义选择最佳的词元组合。</p>
<p>我们可以将不同分词结果中的分词情况表示在一张图上。</p>
<p>下面以对“他是研究生物的”的两种分词结果为例。</p>
<table><thead><tr><th align="center">分词方式</th><th align="center">分词结果</th></tr></thead><tbody>
<tr><td align="center">FMM</td><td align="center">['他', '是', '研究生', '物', '的']</td></tr>
<tr><td align="center">BMM</td><td align="center">['他', '是', '研究', '生物', '的']</td></tr>
</tbody></table>
<p>上面两种分词结果可以形成一无环有向图，即下图所示的网络结构。</p>
<p><img src="assets/word-map-demo.svg" alt="word-map-demo" /></p>
<p>图上任意一条有向边代表的转化关系，即是该边连结的起始结点的词语 \(c_1, c_2\) 在二元文法下的概率 \(p(c_2 |c_1)\)。我们希望找到概率最大的句子，即从起点到终点的一条路径，其经过的边代表的概率之积最大；若我们将图上的每一条边的权值定为概率 \(p\) 的负对数，则求最大概率乘积的问题可以转变为图上的最短路问题。</p>
<h2 id="三整体框架"><a class="header" href="#三整体框架">三、整体框架</a></h2>
<p>包含整体框图，各主要模块的功能。</p>
<p>图表都需要 <strong>带编号</strong></p>
<h2 id="四主要程序模块"><a class="header" href="#四主要程序模块">四、主要程序模块</a></h2>
<p>详细介绍各个主要模块的功能及实现流程。</p>
<h2 id="五实验结果"><a class="header" href="#五实验结果">五、实验结果</a></h2>
<p>详细分析实验结果，除了包含定量评价，还要有定性评价。
对存在的问题，要着重剖析。</p>
<h2 id="六总结"><a class="header" href="#六总结">六、总结</a></h2>
<p>除了对整个实验进行概要总结，如果有程序亮点，可以在这阐述。</p>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<p>如有参考文献，请附上。</p>
<ul>
<li><a href="https://leimao.github.io/blog/Maximum-Likelihood-Estimation-Ngram/">https://leimao.github.io/blog/Maximum-Likelihood-Estimation-Ngram/</a></li>
<li><a href="https://blog.csdn.net/weixin_41510260/article/details/104187534">HanLP《自然语言处理入门》笔记 - 3. 二元语法与中文分词 mantch - CSDN 博客</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../lab/02/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../lab/misc/report-template.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../lab/02/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../lab/misc/report-template.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
